<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://IAmJonoBo.github.io/Emperator/explanation/system-architecture/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>System Architecture Deep Dive - Emperator Technical Brief</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../assets/styles/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Emperator Technical Brief</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Tutorial</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../tutorial/getting-started/" class="dropdown-item">Bootstrapping Emperator in a Repository</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">How-to Guides</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../how-to/author-contract/" class="dropdown-item">Author the Project Contract</a>
</li>
                                    
<li>
    <a href="../../how-to/ci-integration/" class="dropdown-item">Integrate with CI/CD Pipelines</a>
</li>
                                    
<li>
    <a href="../../how-to/ai-assisted-refactors/" class="dropdown-item">Use AI-Assisted Refactors Safely</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Explanation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../executive-summary/" class="dropdown-item">Executive Summary</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">System Architecture Deep Dive</a>
</li>
                                    
<li>
    <a href="../devsecops-supply-chain/" class="dropdown-item">DevSecOps and Supply Chain</a>
</li>
                                    
<li>
    <a href="../developer-experience/" class="dropdown-item">Developer Experience Integration</a>
</li>
                                    
<li>
    <a href="../security-safety/" class="dropdown-item">Security and Safety Envelope</a>
</li>
                                    
<li>
    <a href="../ai-orchestration/" class="dropdown-item">AI-Orchestrated Refactoring</a>
</li>
                                    
<li>
    <a href="../implementation-roadmap/" class="dropdown-item">Implementation Roadmap</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Reference</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../reference/contract-spec/" class="dropdown-item">Project Contract Reference</a>
</li>
                                    
<li>
    <a href="../../reference/toolchain/" class="dropdown-item">Toolchain Matrix</a>
</li>
                                    
<li>
    <a href="../../reference/developer-tooling/" class="dropdown-item">Developer Tooling Reference</a>
</li>
                                    
<li>
    <a href="../../reference/governance/" class="dropdown-item">Governance and Compliance Controls</a>
</li>
                                    
<li>
    <a href="../../includes/copilot-prompts/" class="dropdown-item">Copilot Prompt Patterns</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../executive-summary/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../devsecops-supply-chain/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/IAmJonoBo/Emperator/edit/master/docs/explanation/system-architecture.md" class="nav-link">Edit on IAmJonoBo/Emperator
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#system-architecture-deep-dive" class="nav-link">System Architecture Deep Dive</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#layered-overview" class="nav-link">Layered overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#contract-layer-responsibilities" class="nav-link">Contract layer responsibilities</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#universal-ir-construction" class="nav-link">Universal IR construction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#action-engines-and-safety-envelope" class="nav-link">Action engines and safety envelope</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#extensibility-and-performance" class="nav-link">Extensibility and performance</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#related-references" class="nav-link">Related references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="system-architecture-deep-dive">System Architecture Deep Dive<a class="headerlink" href="#system-architecture-deep-dive" title="Permanent link">&para;</a></h1>
<p>Emperator’s architecture turns a versioned Project Contract into actionable checks, deterministic fixes, and scaffolded code. The system can be reasoned about in three layers that align with the Contract→IR→Action pipeline illustrated below.</p>
<pre class="mermaid"><code>flowchart LR
  subgraph Contract Layer
    A[Contract Assets&lt;br/&gt;(OpenAPI • CUE • Rego • Templates)]
  end
  subgraph IR &amp; Analysis Layer
    B[Universal Code IR&lt;br/&gt;– Tree-sitter CST&lt;br/&gt;– CodeQL semantic DB&lt;br/&gt;– Semgrep pattern index]
  end
  subgraph Execution Layer
    C1[Check Engines]
    C2[Fix Engines]
    C3[Scaffold &amp; Format]
  end
  A --&gt; B --&gt; C1
  C1 --&gt;|Violations?| D{Safety Gate}
  D --&gt;|Auto-fixable| C2 --&gt; C3 --&gt; E[Proposed or Applied Changes]
  D --&gt;|Review needed| E
  E --&gt; F[Re-check &amp; Optional Tests]
  F --&gt;|Pass| G[✅ Standards satisfied]
  F --&gt;|Fail| H[Rollback &amp; Report]</code></pre>
<h2 id="layered-overview">Layered overview<a class="headerlink" href="#layered-overview" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Contract layer:</strong> Stores declarative standards in existing open formats (OpenAPI for interface contracts, CUE for naming/config constraints, OPA Rego for policies, plus codemod templates). Contracts are version-controlled and treated as first-class artefacts so standards evolve without drifting from code.</li>
<li><strong>IR &amp; analysis layer:</strong> Builds a polyglot intermediate representation by combining Tree-sitter concrete syntax trees, CodeQL semantic databases, and Semgrep’s pattern index. The result is a unified graph that supports fast local checks and deep cross-language reasoning.</li>
<li><strong>Execution layer:</strong> Compiles contract rules into checks, fixes, scaffolds, and formatter runs. Each action is orchestrated through the Safety Gate, which classifies findings by severity and determines whether Emperator can auto-remediate or should defer to a developer.</li>
</ul>
<p>This structure maps cleanly to a C4 view: the CLI/LSP service acts as the primary container, backed by modular components (contract loader, IR builder, check coordinator, codemod runner, formatter and report generator) that communicate via typed rule and finding objects.</p>
<h2 id="contract-layer-responsibilities">Contract layer responsibilities<a class="headerlink" href="#contract-layer-responsibilities" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Standards as code:</strong> Contracts leverage proven DSLs so the same definitions can be validated independently or shared across systems. OpenAPI specs drive handler scaffolding, CUE encodes structural constraints, and Rego expresses higher-order policies such as dependency allowlists or security posture requirements.</li>
<li><strong>Versioning and provenance:</strong> Every rule change is traceable. Emperator stamps applied fixes with the contract revision and logs the reasoning, enabling audits and staged rollouts (e.g., warn-only before enforcing breaking rules).</li>
<li><strong>Evidence grading:</strong> Rules can reference external standards (OWASP, MISRA, internal policies) with citations so developers understand the “why” behind each enforcement.</li>
</ul>
<h2 id="universal-ir-construction">Universal IR construction<a class="headerlink" href="#universal-ir-construction" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Tree-sitter parsing:</strong> Provides incremental, lossless CSTs for dozens of languages. Emperator uses them to trigger near real-time diagnostics in editor integrations and to feed higher-level analyses without reparsing entire files.</li>
<li><strong>CodeQL enrichment:</strong> Generates semantic databases for supported languages, exposing control-flow and data-flow relationships. Emperator ships with curated query packs that enforce architecture boundaries, detect security issues, and surface dependency violations.</li>
<li><strong>Semgrep pattern catalog:</strong> Converts contract snippets into multi-language patterns for quick, diff-friendly scans. Community security rules and custom project checks run alongside the contract-derived rules.</li>
<li><strong>Incremental updates:</strong> A background daemon watches source changes, re-running only the relevant analyses. This keeps feedback loops short while supporting large repositories.</li>
</ul>
<h2 id="action-engines-and-safety-envelope">Action engines and safety envelope<a class="headerlink" href="#action-engines-and-safety-envelope" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Check engines:</strong> Run Semgrep rules, CodeQL queries, and contract validators. Findings are tagged with severity, evidence confidence, and auto-fix eligibility. High-noise detections are triaged for manual review.</li>
<li><strong>Fix engines:</strong> Apply deterministic codemods (LibCST, OpenRewrite, language-specific refactorers) for rules classified as safe. Complex migrations can be proposed as diffs rather than applied automatically.</li>
<li><strong>Scaffold &amp; generate:</strong> Templates in <code>contract/generators/</code> create handlers, tests, or migration stubs based on contract deltas (e.g., new OpenAPI endpoints). Generated code is re-checked before acceptance.</li>
<li><strong>Formatters:</strong> Invoke battle-tested formatters such as Ruff, Black, Prettier, gofmt, or clang-format to ensure minimal diffs that match team conventions (see the <a href="../../reference/toolchain/#recommended-lint-and-formatter-stacks">Toolchain Matrix</a> for language-specific pairings).</li>
<li><strong>Safety gate:</strong> Categorizes each change into tiers (formatting, low-risk refactor, complex migration) and enforces validation. After a fix, Emperator re-runs the relevant checks and optional property-based tests before marking the issue resolved. Failures result in automatic rollback and a detailed report.</li>
</ul>
<h2 id="extensibility-and-performance">Extensibility and performance<a class="headerlink" href="#extensibility-and-performance" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Plugin interfaces:</strong> New languages integrate by implementing parser adapters, analyzer hooks, and codemod providers. Policy plug-ins can introduce specialized analyzers (e.g., MISRA checkers) without altering the core orchestrator.</li>
<li><strong>Performance budgets:</strong> Emperator differentiates between fast interactive checks and exhaustive CI runs. Users can opt into deeper analyses (full CodeQL packs, fuzz tests) in pipelines while keeping pre-commit execution under a few seconds.
<a id="offline-operation"></a></li>
<li><strong>Offline operation:</strong> All components run locally, ensuring suitability for air-gapped environments. Optional AI assistance uses on-prem models only (see the AI-assisted how-to guide for details).</li>
</ul>
<p>With this architecture, Emperator ensures contracts remain executable, analyses stay coherent across languages, and automated changes land safely under rigorous validation.</p>
<h2 id="related-references">Related references<a class="headerlink" href="#related-references" title="Permanent link">&para;</a></h2>
<ul>
<li>Map contract rules to analyzers in the <a href="../../reference/toolchain/">Toolchain Matrix</a>.</li>
<li>Follow the rollout stages in the <a href="../implementation-roadmap/">Implementation Roadmap</a>.</li>
<li>Align governance levers with the <a href="../../reference/governance/">Governance and Compliance reference</a>.</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
        <script src="../../assets/js/mermaid-theme.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
